name: ğŸ’“ Zo Heartbeat & Auto-Fix

on:
  schedule:
    - cron: '30 * * * *'  # Runs at minute 30 of every hour
  workflow_dispatch:      # Allows manual trigger button

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ©º Check Zo Vital Signs
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.ZO_HOST }}
          username: ${{ secrets.ZO_USER }}
          key: ${{ secrets.ZO_SSH_KEY }}
          port: ${{ secrets.ZO_PORT }}
          script: |
            echo "ğŸ‘‹ GitHub Action connected. Server is awake."
            
            # Check if bot is running (look for bot.ts)
            if pgrep -f "src/discord/bot.ts" > /dev/null; then
              echo "âœ… Bot is ACTIVE."
            else
              echo "âš ï¸ Bot is DOWN. Restarting..."
              # Navigate to repo and start
              cd ~/vector-skylab || cd ~/momentum-shadow-dev
              
              # Ensure NVM/Node is in path
              export NVM_DIR="$HOME/.nvm"
              [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
              
              # Start bot in background
              nohup npm run start-bot > /dev/null 2>&1 &
              echo "ğŸš€ Bot restarted."
            fi
